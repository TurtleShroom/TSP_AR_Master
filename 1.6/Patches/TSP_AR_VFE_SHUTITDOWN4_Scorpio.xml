<?xml version="1.0" encoding="utf-8" ?>

<Patch>
	<!-- Aelanna's Model No-li Detector and Insertion Code -->
	<!-- Special thanks to Aelanna for straight-up saving me scores of headaches! -->
	<!-- Add comps field to Settlement WorldObjectDef if it doesn't exist -->
	<Operation Class="PatchOperationConditional">
		<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/weaponTags</xpath>
		<nomatch Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
			<success>Always</success>
			<value>
				<weaponTags></weaponTags>
			</value>
		</nomatch>
	</Operation>
	
	<!-- Add comps field to Settlement WorldObjectDef if it doesn't exist -->
	<Operation Class="PatchOperationConditional">
		<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/recipeMaker</xpath>
		<nomatch Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
			<success>Always</success>
			<value>
				<recipeMaker></recipeMaker>
			</value>
		</nomatch>
	</Operation>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
		<!-- If it does, LET'S FASTING GOOOOOOOOOO!!! -->
		<match Class="PatchOperationSequence">
			<!-- <success>Always</success> -->
			<operations>
				<!--
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/label</xpath>
					<value>
						<label>Manuballista</label>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/description</xpath>
					<value>
						<description>Construct Manuballistae, which are basically miniaturized, portable Scorpioes. Like its predecessors, a Manuballista was a torsion-based siege engines, except they were small enough to be used like later hand held crossbows.</description>
					</value>
				</li>
				-->
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/label</xpath>
					<value>
						<label>Manuballista</label>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/description</xpath>
					<value>
						<description>The masterpiece of Roman siege technology. The Manuballista was invented as a further, portable improvement to the Scorpio. A Manuballista was a torsion-based siege engine small enough to be a hand held crossbow (as opposed to ballistae and the Scorpio). As with its predecessors, its shooting involved "storing" kinetic energy by applying torque (force applied to a rotating object) to ropes. Releasing this launched the missile to spectacular results. It shoots diverse kinds of munitions, such as jagged stones and single pointed bolts.</description>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/thingClass</xpath>
					<value>
						<thingClass>ThingWithComps</thingClass>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_TurretGun_Scorpion"]/minifiedDef</xpath>
					<value>
						<minifiedDef>MinifiedThing</minifiedDef>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/weaponTags</xpath>
					<value>
						<li>NeolithicRangedChief</li>
						<li>NeolithicChief</li>
						<li>NeolithicRangedHeavy</li>
						<li>NeolithicRangedAdvanced</li>
						<li>MedievalRangedHeavy</li>
						<li>MedievalRangedAdvanced</li>
						<li>Manuballista</li>
						<li>DankPyon_Crossbow</li>
						<li>ClassicalScorpion</li>
					</value>
				</li>
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Turret_Scorpion"]</xpath>
				</li>
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs</xpath>
					<value>
						<!-- Now we add it back -->
						<ThingDef ParentName="BaseFilth">
							<defName>VFEC_Turret_Scorpion</defName>
							<label>VFECL Scorpion Stand (ERROR)</label>
							<description>If this is detected within the game, an error has occured, because the Ancient Rim Mod's author did not clean out all references to its Thing Def. It is not supposed to exist if you have the Ancient Rim Mod Series installed.</description>
							<selectable>true</selectable>
							<statBases>
								<MarketValue>0</MarketValue>
								<Beauty>0</Beauty>
								<Cleanliness>0</Cleanliness>
							</statBases>
							<graphicData Inherit="False">
								<texPath>Things/Item/Resource/Bronze/Bronze_a</texPath>
								<graphicClass>Graphic_Single</graphicClass>
								<color>(132,80,52)</color>
								</graphicData>
							<filth>
								<ignoreFilthMultiplierStat>true</ignoreFilthMultiplierStat>
								<disappearsInDays>0.0001~0.001</disappearsInDays>
								<rainWashes>true</rainWashes>
								<cleaningWorkToReduceThickness>1</cleaningWorkToReduceThickness>
								<canFilthAttach>false</canFilthAttach>
								<cleaningSound>Vomit</cleaningSound>
							</filth>
						</ThingDef>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/recipeMaker</xpath>
					<value>
						<recipeMaker>
							<skillRequirements>
								<Crafting>4</Crafting>
							</skillRequirements>
							<researchPrerequisite>AR_Project_Ballistae</researchPrerequisite>
							<unfinishedThingDef>UnfinishedGun</unfinishedThingDef>
							<workSpeedStat>GeneralLaborSpeed</workSpeedStat>
							<workSkill>Crafting</workSkill>
							<effectWorking>Smith</effectWorking>
							<soundWorking>Recipe_Smith</soundWorking>
							<recipeUsers>
								<li>ElectricSmithy</li>
								<li>FueledSmithy</li>
							</recipeUsers>
						</recipeMaker>
					</value>
				</li>
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/costList</xpath>
				</li>
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/stuffCategories</xpath>
				</li>
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/costStuffCount</xpath>
				</li>
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
					<value>
						<costStuffCount>95</costStuffCount>
						<stuffCategories Inherit="False">
							<li>Woody</li>

							<!-- Mod support -->
							<li MayRequire="Dubwise.Rimefeller">Composite</li>
							<li MayRequire="sarg.alphabiomes">AB_ExoticWooden</li>
							<li MayRequire="biomesteam.biomescore">BMT_ChitinStuff</li>
							<li MayRequire="sarg.rimbees">RB_Waxy</li>
							<li MayRequire="eltwofour.mantodeanrace">L24_Stuff_MantodeanOrganic</li>
							<li MayRequire="gguake.race.vivi">VV_Wax</li>
						</stuffCategories>
						<costList></costList>
					</value>
				</li>
			</operations>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
		<!-- If it does, LET'S FASTING GOOOOOOOO!! -->
		<match Class="PatchOperationSequence">
			<operations>
				<li Class="PatchOperationInsert">
					<success>Always</success>
					<xpath>Defs/ThingDef/recipeMaker/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
					<value>
						<li>AR_Project_Ballistae</li>
					</value>
				</li>
				
				<li Class="PatchOperationInsert">
					<success>Always</success>
					<xpath>Defs/RecipeDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
					<value>
						<li>AR_Project_Ballistae</li>
					</value>
				</li>
				
				<li Class="PatchOperationInsert">
					<success>Always</success>
					<xpath>Defs/ThingDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
					<value>
						<li>AR_Project_Ballistae</li>
					</value>
				</li>
				
				<li Class="PatchOperationInsert">
					<success>Always</success>
					<xpath>Defs/TerrainDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
					<value>
						<li>AR_Project_Ballistae</li>
					</value>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ResearchProjectDef/prerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef/recipeMaker/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/RecipeDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/TerrainDef/researchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ThingDef/plant/sowResearchPrerequisites/li[text()="VFEC_Scorpion"]</xpath>
				</li>
				
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef[researchPrerequisite="VFEC_Scorpion"]/researchPrerequisite</xpath>
					<value>
						<researchPrerequisites>
							<li>AR_Project_Ballistae</li>
						</researchPrerequisites>
					</value>
				</li>
				
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/ThingDef/recipeMaker[researchPrerequisite="VFEC_Scorpion"]/researchPrerequisite</xpath>
					<value>
						<researchPrerequisites>
							<li>AR_Project_Ballistae</li>
						</researchPrerequisites>
					</value>
				</li>
				
				<li Class="PatchOperationReplace">
					<success>Always</success>
					<xpath>Defs/TerrainDef[researchPrerequisite="VFEC_Scorpion"]/researchPrerequisite</xpath>
					<value>
						<researchPrerequisites>
							<li>AR_Project_Ballistae</li>
						</researchPrerequisites>
					</value>
				</li>
				
				<li Class="PatchOperationRemove">
					<success>Always</success>
					<xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]</xpath>
				</li>
			</operations>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<!--
	<Operation Class="PatchOperationConditional">
	 DO THE GENTILES KNOW?
		<xpath>Defs/JobDef[defName="VFEC_SetupScorpion"]</xpath>
		If they do, SHUT IT DOWN.
		<match Class="PatchOperationRemove">
			<success>Always</success>
			<xpath>Defs/JobDef[defName="VFEC_SetupScorpion"]</xpath>
		</match>
		If the first XPATH does not exist, the original code stands.
	</Operation>
	-->

	<Operation Class="PatchOperationConditional">
		<!-- DO THE GENTILES KNOW? -->
		<xpath>Defs/RaidStrategyDef[defName="VFEC_ScorpionRaid"]</xpath>
		<!-- If they do, SHUT IT DOWN. -->
		<match Class="PatchOperationRemove">
			<success>Always</success>
			<xpath>Defs/RaidStrategyDef[defName="VFEC_ScorpionRaid"]</xpath>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
  
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ThingDef[defName="VFEC_TurretGun_Scorpion"]/statBases/MarketValue</xpath>
		<!-- If it does, do this replacement. -->
		<match Class="PatchOperationReplace">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/statBases/MarketValue</xpath>
			<value>
				<MarketValue>102</MarketValue>
			</value>
		</match>
		<!-- If it DOES NOT, add this. -->
		<nomatch Class="PatchOperationAdd">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/statBases</xpath>
			<value>
				<MarketValue>102</MarketValue>
			</value>
		</nomatch>
	<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/tradeability</xpath>
		<!-- If it does, do this replacement. -->
		<match Class="PatchOperationReplace">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/tradeability</xpath>
			<value>
				<tradeability>All</tradeability>
			</value>
		</match>
		<!-- If it DOES NOT, add this. -->
		<nomatch Class="PatchOperationAdd">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
			<value>
				<tradeability>All</tradeability>
			</value>
		</nomatch>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/generateCommonality</xpath>
		<!-- If it does, do this replacement. -->
		<match Class="PatchOperationReplace">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/generateCommonality</xpath>
			<value>
				<generateCommonality>0.5</generateCommonality>
			</value>
		</match>
		<!-- If it DOES NOT, add this. -->
		<nomatch Class="PatchOperationAdd">
			<success>Always</success>
			<xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]</xpath>
			<value>
				<generateCommonality>0.5</generateCommonality>
			</value>
		</nomatch>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	
	
  <!--
  <Operation Class="PatchOperationConditional">
    Does this exist?
    <xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
    If it does, add this.
    <match Class="PatchOperationAdd">
      <success>Always</success>
      <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/prerequisites</xpath>
      <value>
        <li>AR_Project_Ballistae</li>
      </value>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  
  <Operation Class="PatchOperationConditional">
    Does this exist?
    <xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
    If it does, do this replacement.
    <match Class="PatchOperationReplace">
      <success>Always</success>
      <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/tab</xpath>
      <value>
        <tab>AR_ResearchTab</tab>
      </value>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  
  This is too advanced to start out having it.
  <Operation Class="PatchOperationConditional">
    DO THE GENTILES KNOW?
    <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]</xpath>
    If they do, SHUT IT DOWN.
    <match Class="PatchOperationRemove">
      <success>Always</success>
      <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/tags</xpath>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  -->
  
  <!--
  <Operation Class="PatchOperationConditional">
    Does this exist?
    <xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
    If it does, do this replacement.
    <match Class="PatchOperationReplace">
      <success>Always</success>
      <xpath>Defs/ThingDef[defName="VFEC_Weapon_Scorpion"]/verbs/li/defaultProjectile</xpath>
      <value>
        <defaultProjectile>AR_Bullet_Scorpio</defaultProjectile>
      </value>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  -->
  
  <!--
  <Operation Class="PatchOperationConditional">
    Does this exist?
    <xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
    If it does, do this replacement.
    <match Class="PatchOperationReplace">
      <success>Always</success>
      <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/researchViewX</xpath>
      <value>
        <researchViewX>6</researchViewX>
      </value>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  
  <Operation Class="PatchOperationConditional">
    Does this exist?
    <xpath>Defs/ThingDef[defName="VFEC_Apparel_LegionnaireArmor"]</xpath>
    If it does, do this replacement.
    <match Class="PatchOperationReplace">
      <success>Always</success>
      <xpath>Defs/ResearchProjectDef[defName="VFEC_Scorpion"]/researchViewY</xpath>
      <value>
        <researchViewY>3</researchViewY>
      </value>
    </match>
    If the first XPATH does not exist, the original code stands.
  </Operation>
  -->
</Patch>