<?xml version="1.0" encoding="utf-8"?>

<Patch>
  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[defName = "WaterTowerS"]</xpath>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationReplace">
			<xpath>Defs/ThingDef[defName = "AR_1x2Fountain"  or defName = "AR_2x2Fountain"]/comps</xpath>
			<value>
				<comps Inherit="False">
					<li>
						<compClass>CompQuality</compClass>
					</li>
					<li Class="CompProperties_HeatPusher">
						<heatPerSecond>-20</heatPerSecond>
						<heatPushMinTemperature>26</heatPushMinTemperature>
					</li>
					<li Class="DubsBadHygiene.CompProperties_Pipe" MayRequire="dubwise.dubsbadhygiene">
						<mode>Sewage</mode>
					</li>
					<li Class="CompProperties_Forbiddable"></li>
					<li Class="CompProperties_Art">
						<nameMaker>NamerArtFurniture</nameMaker>
						<descriptionMaker>ArtDescription_Sculpture</descriptionMaker>
						<minQualityForArtistic>Awful</minQualityForArtistic>
						<canBeEnjoyedAsArt>false</canBeEnjoyedAsArt> <!-- Causes error between Joy Job and Joy Kind, disabled -->
					</li>
					<li>
						<compClass>CompGatherSpot</compClass>
					</li>
					<li Class="CompProperties_MeditationFocus">
						<statDef>MeditationFocusStrength</statDef>
						<focusTypes>
							<li>Artistic</li>
							<li>Dignified</li>
							<li MayRequire="arquebus.stagzmerfolk">Stagz_Water</li>
						</focusTypes>
						<offsets>
							<li Class="FocusStrengthOffset_Quality">
								<curve>
									<points>
										<li>(0,0.1)</li> <!-- awful -->
										<li>(1,0.15)</li> <!-- poor -->
										<li>(2,0.21)</li> <!-- normal -->
										<li>(3,0.25)</li> <!-- good -->
										<li>(4,0.28)</li> <!-- excellent -->
										<li>(5,0.3)</li> <!-- masterwork -->
										<li>(6,0.38)</li> <!-- legendary -->
									</points>
								</curve>
							</li>
						</offsets>
					</li>
				</comps>
			</value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName = "AR_1x2Fountain" or defName = "AR_2x2Fountain"]/thingClass</xpath>
          <value>
            <thingClass>DubsBadHygiene.Building_basin</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
  <Operation Class="PatchOperationConditional">
    <!-- Does this exist? -->
    <xpath>Defs/ThingDef[defName = "WaterTowerS"]</xpath>
    <!-- If it does, do this replacement. -->
    <match Class="PatchOperationReplace">
      <xpath>Defs/ThingDef[defName="AR_1x2Fountain"]/designationCategory</xpath>
      <value>
        <designationCategory>Hygiene</designationCategory>
      </value>
    </match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
  <Operation Class="PatchOperationConditional">
    <!-- Does this exist? -->
    <xpath>Defs/ThingDef[defName = "WaterTowerS"]</xpath>
    <!-- If it does, do this replacement. -->
    <match Class="PatchOperationReplace">
      <xpath>Defs/ThingDef[defName="AR_2x2Fountain"]/designationCategory</xpath>
      <value>
        <designationCategory>Hygiene</designationCategory>
      </value>
    </match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
  <!-- When Pawns seek to gain Joy from the Fountain, it fulfills their Thirst Need -->
  <Operation Class="PatchOperationConditional">
    <!-- Does this exist? -->
    <xpath>Defs/ThingDef[defName="WaterTowerS"]</xpath>
    <!-- If it does, do this replacement. -->
    <match Class="PatchOperationReplace">
      <xpath>Defs/JobDef[defName="AR_DrinkWaterJob"]/driverClass</xpath>
      <value>
        <driverClass>DubsBadHygiene.JobDriver_DrinkFromBasin</driverClass>
      </value>
    </match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
	<!-- Aelanna's Model No-Match Detector and Insertion Code -->
	<!-- Special thanks to Aelanna for straight-up saving me scores of headaches! -->
	<!-- Add comps field to Settlement WorldObjectDef if it doesn't exist -->
	<Operation Class="PatchOperationConditional">
		<xpath>Defs/ResearchProjectDef[defName="Plumbing"]/prerequisites</xpath>
		<nomatch Class="PatchOperationAdd">
			<xpath>Defs/ResearchProjectDef[defName="Plumbing"]</xpath>
			<success>Always</success>
			<value>
				<prerequisites></prerequisites>
			</value>
		</nomatch>
	</Operation>
	<Operation Class="PatchOperationConditional">
		<xpath>Defs/ResearchProjectDef[defName="LogBoilers"]/tags</xpath>
		<nomatch Class="PatchOperationAdd">
			<xpath>Defs/ResearchProjectDef[defName="LogBoilers"]</xpath>
			<success>Always</success>
			<value>
				<tags></tags>
			</value>
		</nomatch>
	</Operation>
  <Operation Class="PatchOperationConditional">
    <!-- Does this exist? -->
    <xpath>Defs/ResearchProjectDef[defName="Plumbing"]</xpath>
    <!-- If it does, add this. -->
    <match Class="PatchOperationAdd">
      <xpath>Defs/ResearchProjectDef[defName="Plumbing"]/tags</xpath>
	  <success>Always</success>
      <value>
        <!-- <li>ClassicStart</li> -->
        <li MayRequire="mlie.ancientrimcore">RomanStart</li>
		<li MayRequire="mlie.ancientrimcore">LowHellenicStart</li>
        <li MayRequire="oskarpotocki.vfe.classical">ClassicalStart</li>
        <li MayRequire="sz.tw.new.guohun">SZ_Start</li>
        <li MayRequire="oskarpotocki.vanillafactionsexpanded.medievalmodule">VFEM_MedievalStart</li>
        <li MayRequire="morishep.tarojun.onioftherim">OotR_OniStart</li>
      </value>
    </match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
  <Operation Class="PatchOperationConditional">
    <!-- Does this exist? -->
    <xpath>Defs/ResearchProjectDef[defName="Plumbing"]</xpath>
    <!-- If it does, do this replacement. -->
    <match Class="PatchOperationReplace">
      <xpath>Defs/ResearchProjectDef[defName="AR_Project_Water_Cooling"]/prerequisites</xpath>
	  <success>Always</success>
      <value>
        <prerequisites>
          <li MayRequire="dubwise.dubsbadhygiene">Plumbing</li>
          <li>PassiveCooler</li>
        </prerequisites>
      </value>
    </match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
  
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>Defs/ResearchProjectDef[defName="AR_Project_Water_Cooling"]</xpath>
		<!-- If it does, do this replacement. -->
		<match Class="PatchOperationReplace">
			<xpath>Defs/ResearchProjectDef[defName="MultiSplitAirCon"]/prerequisites</xpath>
			<success>Always</success>
			<value>
				<prerequisites>
					<!-- <li MayRequire="dubwise.dubsbadhygiene">Plumbing</li> -->
					<li MayRequire="mlie.ancientrimcore">AR_Project_Water_Cooling</li>
				</prerequisites>
			</value>
		</match>
    <!-- If the first XPATH does not exist, the original code stands. -->
  </Operation>
</Patch>